---
#################
# The configuration maps metadata and data from CIENA Waveserver transponders
#
# How to add new mappings:
#  The keys are generated by concatenating 'ciena_waveserver_' with the type (port or channel),
#  the type, subtype aand category (latter 3 are found in the message) in the event separated by underscore. 
#  Data comes in separate messages where one message has a specific type of date (e.g. modem, odu, etc)
#  for a single port or channel
#  Metadata comes in a single message that match ciena_waveserver_port_metadata. Though port
#  is in the name it actually contains channel metadata as well.
#################


##
# type: transponder_port and transponder_channel
# description: CIENA Waveserver Metadata
#
# Rules for mapping metadata for Ciena Waveserver ports and channels
# Indivdual messages have metadata for multiple ports and channels
ciena_waveserver_port_metadata:
  type: transponder_port
  meta_maps:
  # This actually has both port and channel meta
  - name: tpdr_port_meta
    # Optional: This means loop over a list element and extract metadata from each item in list separately
    # List items fields can be accessed using special variable @_iterator0
    foreach: 
      - '[http][json_data][ciena-waveserver-port:waveserver-ports][ports]'
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[@_iterator0][id][name]'
    fields:
      - source: '[@_iterator0][port-id]'
        target: local_id
      - source: '[@_iterator0][id][name]'
        target: name
      - source: '[@_iterator0][id][type]'
        target: type
      - source: '[@_iterator0][id][rate]'
        target: rate
      - source: '[@_iterator0][id][interface-type]'
        target: interface_type 
      - source: '[@_iterator0][id][speed]'
        target: speed
  - name: tpdr_channel_meta
    # Loop over all the ports and then all the channels nested in a port
    # port values can be accessed with @_iterator0 and channel values with @_iterator1
    foreach: 
      - '[http][json_data][ciena-waveserver-port:waveserver-ports][ports]'
      - '[@_iterator0][channels]'
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[@_iterator1][id][name]'
    fields:
      - source: '[@_iterator0][id][name]'
        target: port_name
      - source: '[@_iterator1][channel-id]'
        target: local_id
      - source: '[@_iterator1][id][name]'
        target: name
      - source: '[@_iterator1][id][type]'
        target: type
      - source: '[@_iterator1][id][rate]'
        target: rate
      - source: '[@_iterator1][id][speed]'
        target: speed

##
# type: transponder_port
# description: CIENA Waveserver Port Modem Data
#
# Rules for Modem values of Ciena Waveserver ports
ciena_waveserver_port_modem_data:
  type: transponder_port
  value_maps:
    - id: modem:dgd:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][dgd][average][value]"
      target: "[values][modem][dgd][average]"
      type: float
    - id: modem:dgd:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][dgd][maximum][value]"
      target: "[values][modem][dgd][maximum]"
      type: float
    - id: modem:pdl:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][pdl][average][value]"
      target: "[values][modem][pdl][average]"
      type: float
    - id: modem:pdl:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][pdl][maximum][value]"
      target: "[values][modem][pdl][maximum]"
      type: float
    - id: modem:q_factor:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][q-factor][maximum][value]"
      target: "[values][modem][q_factor][maximum]"
      type: float
    - id: modem:q_factor:q_factor
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][q-factor][q-factor][value]"
      target: "[values][modem][q_factor][q_factor]"
      type: float
    - id: modem:q_factor:standard_deviation
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][q-factor][standard-deviation][value]"
      target: "[values][modem][q_factor][standard_deviation]"
      type: float
    - id: modem:q_factor:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][q-factor][minimum][value]"
      target: "[values][modem][q_factor][minimum]"
      type: float
    - id: modem:osnr:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][osnr][average][value]"
      target: "[values][modem][osnr][average]"
      type: float
    - id: modem:osnr:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][osnr][maximum][value]"
      target: "[values][modem][osnr][maximum]"
      type: float
    - id: modem:osnr:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][osnr][minimum][value]"
      target: "[values][modem][osnr][minimum]"
      type: float
    - id: modem:esnr:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][esnr][average][value]"
      target: "[values][modem][esnr][average]"
      type: float
    - id: modem:esnr:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][esnr][maximum][value]"
      target: "[values][modem][esnr][maximum]"
      type: float
    - id: modem:esnr:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][esnr][minimum][value]"
      target: "[values][modem][esnr][minimum]"
      type: float
    - id: modem:chromatic_dispersion:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][chromatic-dispersion][average][value]"
      target: "[values][modem][chromatic_dispersion][average]"
      type: float
    - id: modem:chromatic_dispersion:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][chromatic-dispersion][maximum][value]"
      target: "[values][modem][chromatic_dispersion][maximum]"
      type: float
    - id: modem:chromatic_dispersion:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][chromatic-dispersion][minimum][value]"
      target: "[values][modem][chromatic_dispersion][minimum]"
      type: float
    - id: modem:fec_error:high_correction_count_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][fec-error][high-correction-count-seconds][value]"
      target: "[values][modem][fec_error][high_correction_count_seconds]"
      type: int
    - id: modem:fec_error:uncorrected_block_count
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][fec-error][uncorrected-block-count][value]"
      target: "[values][modem][fec_error][uncorrected_block_count]"
      type: int
    - id: modem:fec_error:uncorrected_second
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][fec-error][uncorrected-second][value]"
      target: "[values][modem][fec_error][uncorrected_second]"
      type: int
    - id: modem:pre_fec_bit_error_rate:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][pre-fec-bit-error-rate][maximum][value]"
      target: "[values][modem][pre_fec_bit_error_rate][maximum]"
      type: float
    - id: modem:pre_fec_bit_error_rate:bit_error_rate
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][pre-fec-bit-error-rate][bit-error-rate][value]"
      target: "[values][modem][pre_fec_bit_error_rate][bit_error_rate]"
      type: float
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

##
# type: transponder_port
# description: CIENA Waveserver Port OTU Data
#
# Rules for OTU values of Ciena Waveserver ports
ciena_waveserver_port_otu_data:
  type: transponder_port
  value_maps:
    - id: otu:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][unavailable-seconds][value]"
      target: "[values][otu][unavailable_seconds]"
      type: int
    - id: otu:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][background-block-errors][value]"
      target: "[values][otu][background_block_errors]"
      type: int
    - id: otu:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][severely-errored-seconds][value]"
      target: "[values][otu][severely_errored_seconds]"
      type: int
    - id: otu:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][errored-seconds][value]"
      target: "[values][otu][errored_seconds]"
      type: int
    - id: otu:far_end:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][unavailable-seconds][value]"
      target: "[values][otu][far_end][unavailable_seconds]"
      type: int
    - id: otu:far_end:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][background-block-errors][value]"
      target: "[values][otu][far_end][background_block_errors]"
      type: int
    - id: otu:far_end:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][severely-errored-seconds][value]"
      target: "[values][otu][far_end][severely_errored_seconds]"
      type: int
    - id: otu:far_end:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][errored-seconds][value]"
      target: "[values][otu][far_end][errored_seconds]"
      type: int
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

##
# type: transponder_port
# description: CIENA Waveserver Port ODU Data
#
# Rules for ODU values of Ciena Waveserver ports
ciena_waveserver_port_odu_data:
  type: transponder_port
  value_maps:
    - id: odu:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][unavailable-seconds][value]"
      target: "[values][odu][unavailable_seconds]"
      type: int
    - id: odu:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][background-block-errors][value]"
      target: "[values][odu][background_block_errors]"
      type: int
    - id: odu:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][severely-errored-seconds][value]"
      target: "[values][odu][severely_errored_seconds]"
      type: int
    - id: odu:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][errored-seconds][value]"
      target: "[values][odu][errored_seconds]"
      type: int
    - id: odu:far_end:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][unavailable-seconds][value]"
      target: "[values][odu][far_end][unavailable_seconds]"
      type: int
    - id: odu:far_end:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][background-block-errors][value]"
      target: "[values][odu][far_end][background_block_errors]"
      type: int
    - id: odu:far_end:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][severely-errored-seconds][value]"
      target: "[values][odu][far_end][severely_errored_seconds]"
      type: int
    - id: odu:far_end:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][errored-seconds][value]"
      target: "[values][odu][far_end][errored_seconds]"
      type: int
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

##
# type: transponder_port
# description: CIENA Waveserver Port Optical Power Data
#
# Rules for Optical Power values of Ciena Waveserver ports
ciena_waveserver_port_optical_power_data:
  type: transponder_port
  value_maps:
    - id: "optical_power:lanes"
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][optical-power]"
      target: "[values][optical_power][lanes]"
      type: list
      items:
        - id: rx_power:minimum
          field_name: lane
          field_index: lane-number
          source: "[rx-power][minimum][value]"
          target: "[rx_power][minimum]"
          type: float
        - id: rx_power:maximum
          field_name: lane
          field_index: lane-number
          source: "[rx-power][maximum][value]"
          target: "[rx_power][maximum]"
          type: float
        - id: rx_power:average
          field_name: lane
          field_index: lane-number
          source: "[rx-power][average][value]"
          target: "[rx_power][average]"
          type: float
        - id: tx_power:minimum
          field_name: lane
          field_index: lane-number
          source: "[tx-power][minimum][value]"
          target: "[tx_power][minimum]"
          type: float
        - id: tx_power:maximum
          field_name: lane
          field_index: lane-number
          source: "[tx-power][maximum][value]"
          target: "[tx_power][maximum]"
          type: float
        - id: tx_power:average
          field_name: lane
          field_index: lane-number
          source: "[tx-power][average][value]"
          target: "[tx_power][average]"
          type: float
    - id: optical_power:aggregate_power:rx_power:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][rx-power][average][value]"
      target: "[values][optical_power][aggregate_power][rx_power][average]"
      type: float
    - id: optical_power:aggregate_power:rx_power:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][rx-power][maximum][value]"
      target: "[values][optical_power][aggregate_power][rx_power][maximum]"
      type: float
    - id: optical_power:aggregate_power:rx_power:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][rx-power][minimum][value]"
      target: "[values][optical_power][aggregate_power][rx_power][minimum]"
      type: float
    - id: optical_power:aggregate_power:tx_power:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][tx-power][average][value]"
      target: "[values][optical_power][aggregate_power][tx_power][average]"
      type: float
    - id: optical_power:aggregate_power:tx_power:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][tx-power][maximum][value]"
      target: "[values][optical_power][aggregate_power][tx_power][maximum]"
      type: float
    - id: optical_power:aggregate_power:tx_power:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][aggregate-power][tx-power][minimum][value]"
      target: "[values][optical_power][aggregate_power][tx_power][minimum]"
      type: float
    - id: optical_power:channel_power:rx_power:average
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][channel-power][rx-power][average][value]"
      target: "[values][optical_power][channel_power][rx_power][average]"
      type: float
    - id: optical_power:channel_power:rx_power:maximum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][channel-power][rx-power][maximum][value]"
      target: "[values][optical_power][channel_power][rx_power][maximum]"
      type: float
    - id: optical_power:channel_power:rx_power:minimum
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][channel-power][rx-power][minimum][value]"
      target: "[values][optical_power][channel_power][rx_power][minimum]"
      type: float
    - id: optical_power:number_of_lanes
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][number-of-lanes]"
      target: "[values][optical_power][number_of_lanes]"
      type: int
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

##
# type: transponder_port
# description: CIENA Waveserver Port Ethernet Data
#
# Rules for Ethernet values of Ciena Waveserver ports
ciena_waveserver_port_ethernet_data:
  type: transponder_port
  value_maps:
    - id: "ethernet:iface:in_bytes"
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][interface-counts][rx][bytes][value]"
      target: "[values][ethernet][in_bytes]"
      type: float
    - id: "ethernet:iface:in_packets"
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][interface-counts][rx][packets][value]"
      target: "[values][ethernet][in_packets]"
      type: float
    - id: "ethernet:iface:out_bytes"
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][interface-counts][tx][bytes][value]"
      target: "[values][ethernet][out_bytes]"
      type: float
    - id: "ethernet:iface:out_packets"
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][interface-counts][tx][packets][value]"
      target: "[values][ethernet][out_packets]"
      type: float
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

##
# type: transponder_channel
# description: CIENA Waveserver Channel ODU Data
#
# Rules for ODU values of Ciena Waveserver ports
ciena_waveserver_channel_odu_data:
  type: transponder_channel
  value_maps:
    - id: odu:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][unavailable-seconds][value]"
      target: "[values][odu][unavailable_seconds]"
      type: int
    - id: odu:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][background-block-errors][value]"
      target: "[values][odu][background_block_errors]"
      type: int
    - id: odu:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][severely-errored-seconds][value]"
      target: "[values][odu][severely_errored_seconds]"
      type: int
    - id: odu:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][errored-seconds][value]"
      target: "[values][odu][errored_seconds]"
      type: int
    - id: odu:far_end:unavailable_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][unavailable-seconds][value]"
      target: "[values][odu][far_end][unavailable_seconds]"
      type: int
    - id: odu:far_end:background_block_errors
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][background-block-errors][value]"
      target: "[values][odu][far_end][background_block_errors]"
      type: int
    - id: odu:far_end:severely_errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][severely-errored-seconds][value]"
      target: "[values][odu][far_end][severely_errored_seconds]"
      type: int
    - id: odu:far_end:errored_seconds
      source: "[http][json_data][ciena-waveserver-pm:untimed-bin][statistics][far-end][errored-seconds][value]"
      target: "[values][odu][far_end][errored_seconds]"
      type: int
  value_id:
    aggregate: true
    key:
      - type: field
        parents:
          - '[meta][device]'
        params:
          source: '[metric_info][id]'

